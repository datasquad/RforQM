---
title: "Introduction to Data Handling and Statistics"
author: "Ralf Becker"
date: "29 November 2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Preparing your workfile

R is a powerful software for statistical analysis. It is open source and hence FREE software. It is constantly developped and functionality is being improved. The "price" we pay for this is that we have to do a little more set-up work to make it work.

In particular we need packages which are provided for free by researchers/programmers that provide useful functionality.

But we add libraries which enhance its capabilities. 

```{r}
library(tidyverse)    # for almost all data handling tasks
library(readxl)       # to import Excel data
library(ggplot2)      # to produce nice graphiscs
library(stargazer)    # to produce nice results tables
```


# Introduction

Here we use an example which, at the time, made a lot of waves.  Carmen Reinhart and Kenneth Rogoff (2010) wrote work that attempted to examine the [relationship between Debt to GDP levels and GDP growth](https://scholar.harvard.edu/files/rogoff/files/growth_in_time_debt_aer.pdf). Their general conclusion was that, as long as the debt to GDP ration does not exceed 90% there seems to be no clear relationship between the two. However, countries eunning higher debt to GDP ratios are paying a sizeable growth penalty.

The empirical work of Reinhard and Rogoff was critised on three aspects by Thomas Herndon, Michael Ash and Robert Pollin. This work was published in the [Cambridge Journal of Economics in 2014](https://academic.oup.com/cje/article-abstract/38/2/257/1714018?redirectedFrom=fulltext) and previous to that as a working paper. The [working paper's website](https://www.peri.umass.edu/publication/item/526-does-high-public-debt-consistently-stifle-economic-growth-a-critique-of-reinhart-and-rogoff) also contains all the relevant data and code.

# Importing Data

This is a simplified spreadsheet (based on the work of Herndon et al.)

```{r}
RRData <- read_excel("RRdata.xlsx")
str(RRData)  # prints some basic info on variables
```

We can see that three variables are numeric (`num`) variables which is as we expect. The fourth variable `Country` is labeled as a character (`chr`) variable, basically text. It will pay off for later toindicate to R that this is a categorical (nominal) variable. This is done as follows:

```{r}
RRData$Country <- as.factor(RRData$Country)
str(RRData)
```

There are 1171 country-year observations. In the dataset are data from 20 countries:

```{r}
unique(RRData$Country)
```

And data from 1946 to 2009.

```{r}
summary(RRData$Year)
```

`debtgdp` is the debt to GDP ratio

```{r}
summary(RRData$debtgdp)
```

`dRGDP` is GDP growth rate

```{r}
summary(RRData$dRGDP)
```


# An initial basic data plots

Let's have a look at some of the data. We will first look at a scatterplot (using the amazing `ggplot` library).

```{r}
p1 <- ggplot(RRData,aes(debtgdp,dRGDP)) +
  geom_point() +    # this produces the scatter plot
  geom_smooth(method = "lm", se = FALSE)  # this adds the linear line of best fit
p1
```

We could actually run this regression

```{r}
mod1 <- lm(dRGDP~debtgdp, data= RRData)
stargazer(mod1,type="text")
```

There are issues with running a regression like this. Perhaps most importantly that the observations cannot be argued to be independent. The growth rate and debt to GDP ratios of, say, the UK in 1981 is clearly not independent of the data in 1980. In particular debt to GDP ratios are slow moving data.

To illustrate this point we should look at the data as time series.

```{r}
tempdata <- RRData %>% filter(Country %in% c("Germany","Greece","UK","US"))
ggplot(tempdata,aes(Year,debtgdp,color=Country)) +
  geom_line()     # this produces the scatter plot

```

You can clearly see that the data, from year to year, are dependent.

# Some data cuts

Let's look at the data for a few countries

```{r}
tempdata <- RRData %>% filter(Country %in% c("Germany","Greece","UK","US"))
ggplot(tempdata,aes(debtgdp,dRGDP,color=Country)) +
  geom_point()     # this produces the scatter plot

```

From here you can see that different countries appear to have quite different patterns.

Let's calculate average and median growth rates and debt to gdp ratios for these countries. To achieve this we will first group the data by Country `group_by(Country)` and then summarise the variables `dRGDP` and `debtgdp` (`summarise_at(c("dRGDP", "debtgdp"), ...)`) in the resulting groups by applying the mean and median function (funs(mean, median)).

```{r}
tempdata %>% group_by(Country) %>% 
            summarise_at(c("dRGDP", "debtgdp"), funs(mean, median)) %>% 
            print()
```

# Create categorical debt to GDP ratios

In order to replicate some of the analysis in Reinhard and Rogoff and the subsequent critique in Herndon et al. we will want to create categorical variables for the Debt to GDP ratio. In other words we want to 

```{r}
RRData <- RRData %>% mutate(dgcat = cut(RRData$debtgdp, breaks=c(0,30,60,90,Inf)))

RRData %>% group_by(dgcat) %>% 
            summarise_at("dRGDP", funs(mean, median)) %>% 
            print()
```